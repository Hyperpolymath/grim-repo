// Generated by ReScript, PLEASE EDIT WITH CARE

import * as GrimCore from "../../core/GrimCore.mjs";
import * as Belt_Array from "rescript/lib/es6/belt_Array.js";
import * as Js_promise from "rescript/lib/es6/js_promise.js";
import * as Belt_Option from "rescript/lib/es6/belt_Option.js";
import * as Caml_option from "rescript/lib/es6/caml_option.js";

var scriptInfo_matches = ["*://*/*"];

var scriptInfo = {
  name: "grim-dark-mode",
  version: "1.0.0",
  description: "Universal dark mode with sinople color schemes",
  matches: scriptInfo_matches
};

var schemes = [
  {
    name: "fogbinder",
    primary: "#9b59b6",
    secondary: "#1a1a2e",
    accent: "#e17055",
    background: "#0f0f23",
    text: "#f8f9fa",
    textMuted: "#a0a0a0",
    border: "#2d2d4a"
  },
  {
    name: "conative",
    primary: "#6c5ce7",
    secondary: "#16213e",
    accent: "#00b894",
    background: "#0d1117",
    text: "#e6edf3",
    textMuted: "#8b949e",
    border: "#30363d"
  },
  {
    name: "rhodium",
    primary: "#cd7f32",
    secondary: "#1a1a1a",
    accent: "#00cec9",
    background: "#0d0d0d",
    text: "#f0f0f0",
    textMuted: "#888888",
    border: "#333333"
  },
  {
    name: "zotero",
    primary: "#cc2936",
    secondary: "#1a1a1a",
    accent: "#0984e3",
    background: "#121212",
    text: "#e0e0e0",
    textMuted: "#9e9e9e",
    border: "#2d2d2d"
  },
  {
    name: "echidna",
    primary: "#2980b9",
    secondary: "#1a1a2e",
    accent: "#f39c12",
    background: "#0a0a14",
    text: "#e8e8e8",
    textMuted: "#888888",
    border: "#2a2a3e"
  },
  {
    name: "wharf",
    primary: "#27ae60",
    secondary: "#1a2634",
    accent: "#e74c3c",
    background: "#0d1821",
    text: "#ecf0f1",
    textMuted: "#7f8c8d",
    border: "#2c3e50"
  },
  {
    name: "bastion",
    primary: "#8e44ad",
    secondary: "#1a2634",
    accent: "#3498db",
    background: "#0f1624",
    text: "#ecf0f1",
    textMuted: "#7f8c8d",
    border: "#2c3e50"
  },
  {
    name: "vext",
    primary: "#1abc9c",
    secondary: "#1a1a1a",
    accent: "#e74c3c",
    background: "#0d0d0d",
    text: "#f0f0f0",
    textMuted: "#888888",
    border: "#2d2d2d"
  },
  {
    name: "palimpsest",
    primary: "#5f27cd",
    secondary: "#151520",
    accent: "#ff9f43",
    background: "#0a0a10",
    text: "#f5f6fa",
    textMuted: "#8a8a9a",
    border: "#25253a"
  },
  {
    name: "kith",
    primary: "#10ac84",
    secondary: "#151520",
    accent: "#ee5253",
    background: "#0a0a10",
    text: "#f5f6fa",
    textMuted: "#8a8a9a",
    border: "#25253a"
  }
];

var defaultScheme = "fogbinder";

function generateCSS(scheme) {
  return "\n  /* Grim Dark Mode - " + scheme.name + " */\n\n  :root {\n    --grim-bg: " + scheme.background + ";\n    --grim-text: " + scheme.text + ";\n    --grim-text-muted: " + scheme.textMuted + ";\n    --grim-primary: " + scheme.primary + ";\n    --grim-secondary: " + scheme.secondary + ";\n    --grim-accent: " + scheme.accent + ";\n    --grim-border: " + scheme.border + ";\n  }\n\n  html.grim-dark-mode,\n  html.grim-dark-mode body {\n    background-color: var(--grim-bg) !important;\n    color: var(--grim-text) !important;\n  }\n\n  html.grim-dark-mode *:not(\n    img, video, picture, canvas, iframe, svg,\n    [class*=\"icon\"], [class*=\"logo\"], [class*=\"avatar\"],\n    .grim-dark-mode-panel, .grim-dark-mode-panel *\n  ) {\n    background-color: inherit;\n    color: inherit;\n    border-color: var(--grim-border) !important;\n  }\n\n  /* Headers and text */\n  html.grim-dark-mode h1,\n  html.grim-dark-mode h2,\n  html.grim-dark-mode h3,\n  html.grim-dark-mode h4,\n  html.grim-dark-mode h5,\n  html.grim-dark-mode h6 {\n    color: var(--grim-text) !important;\n  }\n\n  html.grim-dark-mode p,\n  html.grim-dark-mode span,\n  html.grim-dark-mode li,\n  html.grim-dark-mode td,\n  html.grim-dark-mode th,\n  html.grim-dark-mode label {\n    color: var(--grim-text) !important;\n  }\n\n  /* Muted text */\n  html.grim-dark-mode .text-muted,\n  html.grim-dark-mode .text-secondary,\n  html.grim-dark-mode small,\n  html.grim-dark-mode .meta,\n  html.grim-dark-mode time,\n  html.grim-dark-mode .date {\n    color: var(--grim-text-muted) !important;\n  }\n\n  /* Links */\n  html.grim-dark-mode a {\n    color: var(--grim-primary) !important;\n  }\n  html.grim-dark-mode a:hover {\n    color: var(--grim-accent) !important;\n  }\n\n  /* Backgrounds */\n  html.grim-dark-mode div,\n  html.grim-dark-mode section,\n  html.grim-dark-mode article,\n  html.grim-dark-mode header,\n  html.grim-dark-mode footer,\n  html.grim-dark-mode nav,\n  html.grim-dark-mode aside,\n  html.grim-dark-mode main {\n    background-color: var(--grim-bg) !important;\n  }\n\n  /* Cards and panels */\n  html.grim-dark-mode .card,\n  html.grim-dark-mode .panel,\n  html.grim-dark-mode .box,\n  html.grim-dark-mode .container,\n  html.grim-dark-mode .wrapper {\n    background-color: var(--grim-secondary) !important;\n    border-color: var(--grim-border) !important;\n  }\n\n  /* Inputs */\n  html.grim-dark-mode input,\n  html.grim-dark-mode textarea,\n  html.grim-dark-mode select {\n    background-color: var(--grim-secondary) !important;\n    color: var(--grim-text) !important;\n    border-color: var(--grim-border) !important;\n  }\n  html.grim-dark-mode input::placeholder,\n  html.grim-dark-mode textarea::placeholder {\n    color: var(--grim-text-muted) !important;\n  }\n\n  /* Buttons */\n  html.grim-dark-mode button,\n  html.grim-dark-mode .btn,\n  html.grim-dark-mode [role=\"button\"] {\n    background-color: var(--grim-primary) !important;\n    color: var(--grim-bg) !important;\n    border-color: var(--grim-primary) !important;\n  }\n  html.grim-dark-mode button:hover,\n  html.grim-dark-mode .btn:hover {\n    background-color: var(--grim-accent) !important;\n    border-color: var(--grim-accent) !important;\n  }\n\n  /* Code */\n  html.grim-dark-mode pre,\n  html.grim-dark-mode code {\n    background-color: " + scheme.secondary + " !important;\n    color: " + scheme.accent + " !important;\n  }\n\n  /* Tables */\n  html.grim-dark-mode table {\n    background-color: var(--grim-bg) !important;\n  }\n  html.grim-dark-mode th {\n    background-color: var(--grim-secondary) !important;\n  }\n  html.grim-dark-mode tr:nth-child(even) {\n    background-color: rgba(255, 255, 255, 0.02) !important;\n  }\n  html.grim-dark-mode tr:hover {\n    background-color: rgba(255, 255, 255, 0.05) !important;\n  }\n\n  /* Scrollbar */\n  html.grim-dark-mode ::-webkit-scrollbar {\n    width: 10px;\n    height: 10px;\n  }\n  html.grim-dark-mode ::-webkit-scrollbar-track {\n    background: var(--grim-bg);\n  }\n  html.grim-dark-mode ::-webkit-scrollbar-thumb {\n    background: var(--grim-border);\n    border-radius: 5px;\n  }\n  html.grim-dark-mode ::-webkit-scrollbar-thumb:hover {\n    background: var(--grim-text-muted);\n  }\n\n  /* Selection */\n  html.grim-dark-mode ::selection {\n    background: var(--grim-primary);\n    color: var(--grim-bg);\n  }\n\n  /* Focus */\n  html.grim-dark-mode *:focus {\n    outline-color: var(--grim-primary) !important;\n  }\n  ";
}

var panelCSS = "\n  .grim-dark-mode-panel {\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    z-index: 999999;\n    background: #1a1a2e !important;\n    border: 1px solid #2d2d4a !important;\n    border-radius: 12px;\n    padding: 16px;\n    min-width: 200px;\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);\n    font-family: -apple-system, BlinkMacSystemFont, sans-serif !important;\n    color: #f8f9fa !important;\n  }\n  .grim-dark-mode-panel * {\n    color: #f8f9fa !important;\n  }\n  .grim-dark-mode-toggle {\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: 12px;\n  }\n  .grim-dark-mode-toggle-label {\n    font-weight: 600;\n    font-size: 14px !important;\n  }\n  .grim-dark-mode-switch {\n    position: relative;\n    width: 48px;\n    height: 24px;\n    background: #2d2d4a;\n    border-radius: 12px;\n    cursor: pointer;\n    transition: background 0.2s;\n  }\n  .grim-dark-mode-switch.active {\n    background: #6c5ce7;\n  }\n  .grim-dark-mode-switch::after {\n    content: '';\n    position: absolute;\n    top: 2px;\n    left: 2px;\n    width: 20px;\n    height: 20px;\n    background: #f8f9fa;\n    border-radius: 50%;\n    transition: transform 0.2s;\n  }\n  .grim-dark-mode-switch.active::after {\n    transform: translateX(24px);\n  }\n  .grim-dark-mode-schemes {\n    display: grid;\n    grid-template-columns: repeat(5, 1fr);\n    gap: 6px;\n  }\n  .grim-dark-mode-scheme {\n    width: 28px;\n    height: 28px;\n    border-radius: 6px;\n    cursor: pointer;\n    border: 2px solid transparent;\n    transition: border-color 0.2s, transform 0.2s;\n  }\n  .grim-dark-mode-scheme:hover {\n    transform: scale(1.1);\n  }\n  .grim-dark-mode-scheme.active {\n    border-color: #f8f9fa;\n  }\n  .grim-dark-mode-scheme-name {\n    font-size: 10px !important;\n    color: #a0a0a0 !important;\n    text-align: center;\n    margin-top: 8px;\n  }\n  .grim-dark-mode-collapse {\n    position: absolute;\n    top: 8px;\n    right: 8px;\n    cursor: pointer;\n    opacity: 0.6;\n    font-size: 16px !important;\n  }\n  .grim-dark-mode-collapse:hover { opacity: 1; }\n  .grim-dark-mode-panel.collapsed {\n    min-width: auto;\n    padding: 8px 12px;\n  }\n  .grim-dark-mode-panel.collapsed .grim-dark-mode-schemes,\n  .grim-dark-mode-panel.collapsed .grim-dark-mode-scheme-name {\n    display: none;\n  }\n";

var storageKey = "dark_mode";

var schemeKey = "dark_mode_scheme";

var styleElement = {
  contents: undefined
};

function getScheme(name) {
  return Belt_Array.getBy(schemes, (function (s) {
                return s.name === name;
              }));
}

function applyScheme(scheme) {
  var el = styleElement.contents;
  if (el !== undefined) {
    Caml_option.valFromOption(el).remove();
  }
  var style = GrimCore.DOM.create("style", undefined, "grim-dark-mode-style");
  style.innerHTML = generateCSS(scheme);
  var head = GrimCore.DOM.query("head");
  if (head !== undefined) {
    Caml_option.valFromOption(head).appendChild(style);
  }
  styleElement.contents = Caml_option.some(style);
  var html = GrimCore.DOM.query("html");
  if (html !== undefined) {
    Caml_option.valFromOption(html)["classList.add"]("grim-dark-mode");
  }
  GrimCore.Log.debug("Applied scheme: " + scheme.name);
}

function removeScheme() {
  var el = styleElement.contents;
  if (el !== undefined) {
    Caml_option.valFromOption(el).remove();
    styleElement.contents = undefined;
  }
  var html = GrimCore.DOM.query("html");
  if (html !== undefined) {
    Caml_option.valFromOption(html)["classList.remove"]("grim-dark-mode");
    return ;
  }
  
}

function isEnabled() {
  var __x = GrimCore.$$Storage.get("Local", storageKey);
  return Js_promise.then_((function (value) {
                return Promise.resolve(value === "true");
              }), __x);
}

function getCurrentScheme() {
  var __x = GrimCore.$$Storage.get("Local", schemeKey);
  return Js_promise.then_((function (value) {
                return Promise.resolve(Belt_Option.getWithDefault(value, defaultScheme));
              }), __x);
}

function setEnabled(enabled, schemeName) {
  if (enabled) {
    var scheme = getScheme(schemeName);
    if (scheme !== undefined) {
      applyScheme(scheme);
    }
    
  } else {
    removeScheme();
  }
  var __x = GrimCore.$$Storage.set("Local", storageKey, enabled ? "true" : "false");
  return Js_promise.then_((function () {
                return GrimCore.$$Storage.set("Local", schemeKey, schemeName);
              }), __x);
}

function createPanel(enabled, schemeName) {
  GM_addStyle(panelCSS);
  var panel = GrimCore.DOM.create("div", "grim-dark-mode-panel", undefined);
  var schemesHtml = Belt_Array.map(schemes, (function (scheme) {
            var activeClass = scheme.name === schemeName ? "active" : "";
            return "<div class=\"grim-dark-mode-scheme " + activeClass + "\"\n          data-scheme=\"" + scheme.name + "\"\n          style=\"background: linear-gradient(135deg, " + scheme.primary + ", " + scheme.accent + ")\"\n          title=\"" + scheme.name + "\"></div>";
          })).join("");
  var switchClass = enabled ? "active" : "";
  panel.innerHTML = "\n    <span class=\"grim-dark-mode-collapse\">âˆ’</span>\n    <div class=\"grim-dark-mode-toggle\">\n      <span class=\"grim-dark-mode-toggle-label\">ðŸŒ™ Dark Mode</span>\n      <div class=\"grim-dark-mode-switch " + switchClass + "\" id=\"grim-dark-toggle\"></div>\n    </div>\n    <div class=\"grim-dark-mode-schemes\">\n      " + schemesHtml + "\n    </div>\n    <div class=\"grim-dark-mode-scheme-name\">" + schemeName + "</div>\n  ";
  document.body.appendChild(panel);
  var toggle = GrimCore.DOM.query("#grim-dark-toggle");
  if (toggle !== undefined) {
    var toggle$1 = Caml_option.valFromOption(toggle);
    toggle$1.addEventListener("click", (function (param) {
            var isActive = toggle$1["classList.contains"]("active");
            var newEnabled = !isActive;
            if (newEnabled) {
              toggle$1["classList.add"]("active");
            } else {
              toggle$1["classList.remove"]("active");
            }
            ((function (__x) {
                    return Js_promise.then_((function (scheme) {
                                  return setEnabled(newEnabled, scheme);
                                }), __x);
                  })(getCurrentScheme()));
          }));
  }
  Belt_Array.forEach(GrimCore.DOM.queryAll(".grim-dark-mode-scheme"), (function (schemeEl) {
          schemeEl.addEventListener("click", (function (param) {
                  var name = schemeEl.getAttribute("data-scheme");
                  if (name == null) {
                    return ;
                  }
                  Belt_Array.forEach(GrimCore.DOM.queryAll(".grim-dark-mode-scheme"), (function (el) {
                          el["classList.remove"]("active");
                        }));
                  schemeEl["classList.add"]("active");
                  var nameEl = GrimCore.DOM.query(".grim-dark-mode-scheme-name");
                  if (nameEl !== undefined) {
                    Caml_option.valFromOption(nameEl).textContent = name;
                  }
                  ((function (__x) {
                          return Js_promise.then_((function (enabled) {
                                        if (enabled) {
                                          setEnabled(true, name);
                                        } else {
                                          GrimCore.$$Storage.set("Local", schemeKey, name);
                                        }
                                        return Promise.resolve();
                                      }), __x);
                        })(isEnabled()));
                }));
        }));
  var btn = GrimCore.DOM.query(".grim-dark-mode-collapse");
  if (btn === undefined) {
    return ;
  }
  var btn$1 = Caml_option.valFromOption(btn);
  btn$1.addEventListener("click", (function (param) {
          panel["classList.toggle"]("collapsed");
          var isCollapsed = panel["classList.contains"]("collapsed");
          btn$1.textContent = isCollapsed ? "+" : "âˆ’";
        }));
}

function run() {
  GrimCore.Log.info("Dark Mode running");
  ((function (__x) {
          return Js_promise.then_((function (param) {
                        var schemeName = param[1];
                        var enabled = param[0];
                        if (enabled) {
                          var scheme = getScheme(schemeName);
                          if (scheme !== undefined) {
                            applyScheme(scheme);
                          }
                          
                        }
                        createPanel(enabled, schemeName);
                        return Promise.resolve();
                      }), __x);
        })(Promise.all([
              isEnabled(),
              getCurrentScheme()
            ])));
}

GrimCore.Registry.register("grim-dark-mode", scriptInfo);

if ((document.readyState === "complete")) {
  run();
} else {
  document.body.addEventListener("DOMContentLoaded", (function (param) {
          run();
        }));
}

export {
  scriptInfo ,
  schemes ,
  defaultScheme ,
  generateCSS ,
  panelCSS ,
  storageKey ,
  schemeKey ,
  styleElement ,
  getScheme ,
  applyScheme ,
  removeScheme ,
  isEnabled ,
  getCurrentScheme ,
  setEnabled ,
  createPanel ,
  run ,
}
/*  Not a pure module */
